#!/bin/bash

# ##############################################################################
# bspwm setup environment
# ##############################################################################

export XDG_CURRENT_DESKTOP="GNOME-Flashback:GNOME"
export XDG_SESSION_DESKTOP=x11;
export XDG_SESSION_TYPE=x11;
export XDG_MENU_PREFIX=gnome-flashback-;
export XDG_RUNTIME_DIR="/run/user/$UID"
export DBUS_SESSION_BUS_ADDRESS="unix:path=${XDG_RUNTIME_DIR}/bus"
xrdb ~/.Xresources;
xsetroot -cursor_name left_ptr;

# ##############################################################################
# bspwm monitor workspace setup
# ##############################################################################

hdmiConnected=$(xrandr -q | grep "HDMI-2 connected" &> /dev/null; echo $?);
if [[ "$hdmiConnected" == "0" ]]; then
  bspc monitor eDP-1 -d 1 2 3 4 5;
  bspc monitor HDMI-2 -d 6 7 8 9 0;
else
  bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9 0;
fi

# ##############################################################################
# bspwm auto-start applications
# ##############################################################################

pgrep -f sxhkd || sxhkd &
systemctl --user is-active gsd-a11y-settings.target || systemctl --user start gsd-a11y-settings.target
systemctl --user is-active gsd-housekeeping.target || systemctl --user start gsd-housekeeping.target
systemctl --user is-active gsd-power.target || systemctl --user start gsd-power.target
systemctl --user is-active gsd-screensaver-proxy.target || systemctl --user start gsd-screensaver-proxy.target
systemctl --user is-active gsd-sound.target || systemctl --user start gsd-sound.target
systemctl --user is-active gsd-wwan.target || systemctl --user start gsd-wwan.target
systemctl --user is-active gsd-color.target || systemctl --user start gsd-color.target
systemctl --user is-active gsd-keyboard.target || systemctl --user start gsd-keyboard.target
systemctl --user is-active gsd-print-notifications.target || systemctl --user start gsd-print-notifications.target
systemctl --user is-active gsd-sharing.target || systemctl --user start gsd-sharing.target
systemctl --user is-active gsd-usb-protection.target || systemctl --user start gsd-usb-protection.target
systemctl --user is-active gsd-xsettings.target || systemctl --user start gsd-xsettings.target
systemctl --user is-active gsd-datetime.target || systemctl --user start gsd-datetime.target
systemctl --user is-active gsd-media-keys.target || systemctl --user start gsd-media-keys.target
systemctl --user is-active gsd-rfkill.target || systemctl --user start gsd-rfkill.target
systemctl --user is-active gsd-smartcard.target || systemctl --user start gsd-smartcard.target
systemctl --user is-active gsd-wacom.target || systemctl --user start gsd-wacom.target
systemctl --user is-active indicators-pre.target || systemctl --user start indicators-pre.target;
systemctl --user is-active indicator-application.service || systemctl --user start indicator-application.service;
systemctl --user is-active indicator-bluetooth.service || systemctl --user start indicator-bluetooth.service;
systemctl --user is-active indicator-datetime.service || systemctl --user start indicator-datetime.service;
systemctl --user is-active indicator-keyboard.service || systemctl --user start indicator-keyboard.service;
systemctl --user is-active indicator-messages.service || systemctl --user start indicator-messages.service;
systemctl --user is-active indicator-power.service || systemctl --user start indicator-power.service;
systemctl --user is-active indicator-printers.service || systemctl --user start indicator-printers.service;
systemctl --user is-active indicator-session.service || systemctl --user start indicator-session.service;
systemctl --user is-active indicator-sound.service || systemctl --user start indicator-sound.service;
pgrep -f gnome-panel || gnome-panel &
pgrep -f gnome-flashback || gnome-flashback &
pgrep -f nm-applet || nm-applet &
pgrep -f caffeine-indicator || caffeine-indicator &

# ##############################################################################
# bspwm setup configurations
# ##############################################################################

bspc config initial_polarity second_child;
bspc config top_padding 24;
bspc config right_padding 0;
bspc config bottom_padding 24;
bspc config left_padding 0;
bspc config window_gap 16;
bspc config border_width 1
bspc config pointer_modifier mod5; # Opt_L => mod1
bspc config pointer_action1 move;
bspc config pointer_action2 resize_corner;
bspc config focus_follows_pointer false;
bspc config pointer_follows_focus false;

# ##############################################################################
# bspwm window rules
# ##############################################################################

bspc rule -a "Gimp*" state=floating;
bspc rule -a "Onboard" state=floating;
bspc rule -a "Gnome-calculator" state=floating;
